<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Adaptive Video Player</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link
			rel="stylesheet"
			href="https://solid-design-system.fe.union-investment.de/components/5.16.1/cdn/solid-components.css"
		/>
		<script
			type="module"
			src="https://solid-design-system.fe.union-investment.de/components/5.16.1/cdn/solid-components.bundle.js"
		></script>
		<script src="https://cdn.jsdelivr.net/npm/hls.js@1.6.14/dist/hls.min.js"></script>
	</head>
	<body class="p-8">
		<sd-video id="video-wrapper" class="w-full aspect-video">
			<video
				id="my-video"
				class="w-full aspect-video"
				controls
				preload="auto"
			></video>

			<img
				slot="poster"
				alt="Video preview"
				class="w-full aspect-video object-cover"
				src="https://placehold.co/1920x1080"
			/>
		</sd-video>

		<script type="module">
			const videoWrapper = document.getElementById("video-wrapper");
			const video = document.getElementById("my-video");
			const videoSrc = "/videos/master.m3u8";

			if (Hls.isSupported()) {
				const hls = new Hls({
					enableWorker: true,
					capLevelToPlayerSize: true,
				});

				hls.loadSource(videoSrc);
				hls.attachMedia(video);

				hls.on(Hls.Events.MANIFEST_PARSED, () => {
					console.log("Available levels:", hls.levels);
				});

				hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
					const level = hls.levels[data.level];
					console.log("Quality switched:", {
						quality: level.height ? `${level.height}p` : "Auto",
						resolution: `${level.width}x${level.height}`,
						bandwidth: `${(level.bitrate / 1000).toFixed(0)} kbps`,
					});
				});

				window.addEventListener("beforeunload", () => {
					hls.destroy();
				});
			} else if (video.canPlayType("application/vnd.apple.mpegurl")) {
				video.src = videoSrc;
				console.log("Using native HLS support");
			}

			videoWrapper.addEventListener("sd-play", () => {
				video.play();
			});
		</script>
	</body>
</html>
